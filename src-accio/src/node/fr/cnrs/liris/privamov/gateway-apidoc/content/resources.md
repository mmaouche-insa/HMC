## Datasets

A dataset contains data collected during a crowd sensing campaign.

### List datasets

List all available datasets.

```endpoint
GET /datasets
```

#### Example request

```curl
$ curl https://privamov.liris.cnrs.fr/api/datasets
```

#### Example response

```json
[
  {
    "id": "middleware14",
    "storage": "csv/macaco",
    "description": "Data collection during Middleware'14 conference"
  },
  {
    "id": "privamov",
    "storage": "postgis",
    "description": "Main campaign using Priva'Mov devices"
  }
]
```

The response body is a list of JSON objects containing the following properties.

| Property                  | Description                   |
| ------------------------- | ----------------------------- |
| `id`                      | unique identifier             |
| `storage`                 | storage type                  |
| `description` (optional)  | human-readable description    |

### Retrieve a dataset

Retrieve information about a single dataset, by its identifier.

```endpoint
GET /datasets/{dataset_id}
```

#### Example request

```curl
$ curl https://privamov.liris.cnrs.fr/api/datasets/privamov
```

#### Example response
```json
{
  "id": "privamov",
  "storage": "postgis",
  "description": "Main campaign using Priva'Mov devices"
  }
```

### List sources

List sources a dataset is composed of, with the temporal window for which we have data for each source.

```endpoint
GET /datasets/{dataset_id}/sources
```

#### Example request

```curl
$ curl https://privamov.liris.cnrs.fr/api/datasets/privamov/sources
```

This endpoint supports pagination. Moreover, it supports the following parameters.

| Query parameter | Description |
| --------------- | ----------- |
| `q` | expression to filter source identifiers (supports `*`, `?` and `+` as wildcards and `|` to delimite multiple alternatives) |

#### Example response
```json
[
  {
    "id": "0",
    "from": "2015-01-01T07:04:54Z",
    "to": "2016-04-21T16:32:21Z"
  },
  {
    "id": "1",
    "from": "2014-10-25T06:27:32Z",
    "to": "2015-06-12T00:12:01Z"
  },
  ...
]
```

The response body is a list of JSON objects containing the following properties.

| Property  | Description |
| --------- | ------------|
| `id`      | unique identifier of the source within the dataset |
| `from`    | first time at which this source generated an event |
| `to`      | last time at which this source generated an event |

### Retrieve a source

Retrieve a single source from a dataset, with aggregated information such as the number of events it generated and the temporal extent for which we have data for it.

```endpoint
GET /datasets/{dataset_id}/sources/{source_id}
```

#### Example request

```curl
$ curl https://privamov.liris.cnrs.fr/api/datasets/privamov/sources/0
```

#### Example response
```json
{
  "id": "0",
  "count": 169035,
  "from": "2015-01-01T07:04:54Z",
  "to": "2016-04-21T16:32:21Z",
  "days": ["2015-01-01","2015-01-02",...,"2016-04-21"]
}
```

The response body is a JSON object containing the following properties.

| Property | Description |
| -------- | ------------|
| `id` | unique identifier of the source within the dataset |
| `count` | number of events generated by this source |
| `from`| first time at which this source generated an event |
| `to` | last time at which this source generated an event |
| `days` | days for which we have activity for this source |

### List features

Retrieve features of a dataset, in chronological order. You can restrict the time window and data sources to consider. You can also limit the maximum number of features that will be retrieved. only the first in chronological order will be retrieved. If you want to have a better overview of the data over the whole time period, you can ask data to be sampled.

```endpoint
GET /datasets/{dataset_id}/features
```

#### Example request

```curl
$ curl "https://privamov.liris.cnrs.fr/api/datasets/privamov/features?sources=0,1&limit=5000"
```

This endpoint supports pagination. Moreover, it supports the following parameters.

| Query parameter | Description |
| --------------- | ----------- |
| `sources` | comma-separated list of sources to consider |
| `limit` | maximum number of features to retrieve |
| `sample` | whether to sample data or not (useful in combination with `limit`) |
| `from` | minimum time of features to retrieve |
| `to` | maximum time of features to retrieve |

#### Example response
```json
{
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "id": "12345",
      "geometry": {"type": "Point", "coordinates": [4.56775, 34.58020]},
      "properties": {"source": "0", "time": "2015-01-01T07:04:54Z"}
    },
    {
      "type": "Feature",
      "id": "12353",
      "geometry": {"type": "Point", "coordinates": [4.39265, 34.90401]},
      "properties": {"source": "0", "time": "2015-01-01T07:05:30Z"}
    },
    ...
  ]
}
```

The response body is a [GeoJSON](http://geojson.org/geojson-spec.html) FeatureCollection object, containing Feature objects whose geometry is always a Point object.

## Exports

### Create an export

Create an export request.

```endpoint
POST /exports
```

#### Example request

```curl
$ curl -X "https://privamov.liris.cnrs.fr/api/exports"
```

#### Example request body

```json
{
  "dataset": "privamov",
  "sources": ["0","2","3","4"],
  "limit": 10000,
  "from": "2015-01-01T07:04:54Z",
  "format": "csv"
}
```

The request body is a JSON object containing the following properties.

| Query parameter | Description |
| --------------- | ----------- |
| `dataset` | (required) name of the dataset |
| `sources` | comma-separated list of sources to consider |
| `limit` | maximum number of features to retrieve |
| `sample` | whether to sample data or not (useful in combination with `limit`) |
| `from` | minimum time of features to retrieve |
| `to` | maximum time of features to retrieve |
| `format` | (optional) export format, one of `csv` (default), `json` |

#### Example response

```json
{
  "id": "23j9mpo",
  "created": "2016-04-26T14:15:34Z",
  "status": "running",
  "progress": 0,
  "error": null,
  "download_url": null
}
```

The response body is a JSON object containing the following properties.

| Property | Description |
| -------- |------------ |
| `id` | unique identifier of the export |
| `created` | date at which the export was created |
| `completed` | date at which the export was completed, either successfully or errored (null if still in progress) |
| `status` | current status (one of `queued`, `running`, `errored`, `successful`) |
| `progress` | export progress (float between 0 and 1) |
| `error` | error description if the export failed (null if successful) |
| `download_url` | URL at which the export can be downloaded (null if still in progress or errored) |

### Retrieve export status

Retrieve the status of an export.

```endpoint
GET /exports/{export_id}
```

#### Example request

```curl
$ curl "https://privamov.liris.cnrs.fr/api/exports/23j9mpo"
```

#### Example response

```json
{
  "id": "23j9mpo",
  "created": "2016-04-26T14:15:34Z",
  "status": "running",
  "progress": 0.5,
  "error": null,
  "download_url": null
}
```